deSolve,
tidyverse,
openxlsx,
MetBrewer,
ggsci,
scales,
patchwork
)
age_id <- rep(1:7, each = 4)
vac_id <- rep(1:4, 7)
str_glue('age{age_id[1]}_vac{vac_id[1]}')
5*28
change_col <- function(data, col) {
for (i in 1:28) {
data %>%
mutate(col = case_when(col %in% seq(i, 5*28+i, 28) ~ str_glue('age{age_id[i]}_vac{vac_id[i]}')))
}
}
m <- 28  #number of age and vac classes
# inital value FOR six compartment
V0 <- read.xlsx('pop_of_S_28.xlsx', sheet = 1)
V0 <- V0$n_fujian # inital value for number of susceptible stratified by vaccination status
E0 <- rep(0, 28) # inital value for number of exposed
P0 <- rep(0, 28)
A0 <- rep(0, 28)
I0 <- rep(0, 28) # inital value for number of infectious
I0[13] <- 1
R0 <- rep(0, 28) # inital value for number of recovered
# parameters
beta <- read.xlsx('Beta_28.xlsx', sheet = 1, colNames = F)
beta <- as.matrix(beta) # matrix of transmission rates
kappa1 <- 0.63
kappa2 <- 0.35
HR <- rep(c(1, 0.6992, 0.5531, 0.3665), 7)
mu <- rep(c(0.33, 0.33, 0.33, 0.33), 7)
omega <- 1/3
omegap <- 1/3 # rate at which individuals move from the exposed to the pre-symptom classes
omegapp <- 1/2
gamma <- 1/5 # recovery rate
gammap <- 1/7
f_raw <- read.xlsx('death_rate.xlsx', sheet = 1, colNames = F)
f_raw <- as.matrix(f_raw)
f <- as.vector(t(f_raw))
# combining parameter and initial values
parms <- list(kappa1 = kappa1, kappa2 = kappa2, HR = HR, beta=beta, mu=mu, omega=omega, omegap = omegap,
omegapp = omegapp, gamma=gamma, gammap = gammap, f = f)
INPUT <- c(V0, E0, P0, A0, I0, R0)
ND <- 365 # time to simulate
TS <- 1 # time step to simualte is days
# constructing time vector
t_start <- 0 # starting time
t_end <- ND - 1 # ending time
t_inc <- TS #time increment
t_range <- seq(from= t_start, to=t_end+t_inc, by=t_inc) # vector with time steps
# differential equations --------------------------------------------------
diff_eqs <- function(times, Y, parms){
dY <- numeric(length(Y))
with(parms,{
for(i in 1:m){
# V_i
dY[i] <- - beta[, i] %*% (Y[4*m + seq(1:m)] + kappa1*Y[2*m + seq(1:m)] + kappa2*Y[3*m + seq(1:m)]) * HR[i] * Y[i]
# E_i
dY[m+i] <- beta[, i] %*% (Y[4*m + seq(1:m)] + kappa1*Y[2*m + seq(1:m)] + kappa2*Y[3*m + seq(1:m)]) * HR[i] * Y[i] - mu[i]*omega*Y[m+i] - (1-mu[i])*omegap*Y[m+i]
# P_i
dY[2*m+i] <- (1-mu[i])*omegap*Y[m+i] - omegapp*Y[2*m+i]
# A_i
dY[3*m+i] <- mu[i]*omega*Y[m+i] - gammap*Y[3*m+i]
# I_i
dY[4*m+i] <- omegapp*Y[2*m+i] - gamma*Y[4*m+i] - f[i]*Y[4*m+i]
# R_i
dY[5*m+i] <- gamma*Y[4*m+i] + gammap*Y[3*m+i]
}
list(dY)
})
}
out <- ode(INPUT, t_range, diff_eqs, parms, method = 'rk4')
out <- as.data.frame(out)
View(out)
df <- out %>%
pivot_longer(
cols = -1,
names_to = 'group',
values_to = 'value'
) %>%
mutate(group = as.numeric(group),
status = group) %>%
mutate(status = case_when(status %in% seq(1,       m) ~ 'Susceptible',
status %in% seq(m+1,   2*m) ~ 'Exposed',
status %in% seq(2*m+1, 3*m) ~ 'Pre-symptomatic',
status %in% seq(3*m+1, 4*m) ~ 'Asymptomatic',
status %in% seq(4*m+1, 5*m) ~ 'Infectious',
status %in% seq(5*m+1, 6*m) ~ 'Recovered')) %>%
mutate(status = fct_relevel(status, "Susceptible", 'Exposed', 'Pre-symptomatic',
'Asymptomatic', 'Infectious', 'Recovered')) %>%
change_col(group)
df <- out %>%
pivot_longer(
cols = -1,
names_to = 'group',
values_to = 'value'
) %>%
mutate(group = as.numeric(group),
status = group) %>%
mutate(status = case_when(status %in% seq(1,       m) ~ 'Susceptible',
status %in% seq(m+1,   2*m) ~ 'Exposed',
status %in% seq(2*m+1, 3*m) ~ 'Pre-symptomatic',
status %in% seq(3*m+1, 4*m) ~ 'Asymptomatic',
status %in% seq(4*m+1, 5*m) ~ 'Infectious',
status %in% seq(5*m+1, 6*m) ~ 'Recovered')) %>%
mutate(status = fct_relevel(status, "Susceptible", 'Exposed', 'Pre-symptomatic',
'Asymptomatic', 'Infectious', 'Recovered'))
head(df)
df <- df %>%
change_col('group')
head(df)
df <- out %>%
pivot_longer(
cols = -1,
names_to = 'group',
values_to = 'value'
) %>%
mutate(group = as.numeric(group),
status = group) %>%
mutate(status = case_when(status %in% seq(1,       m) ~ 'Susceptible',
status %in% seq(m+1,   2*m) ~ 'Exposed',
status %in% seq(2*m+1, 3*m) ~ 'Pre-symptomatic',
status %in% seq(3*m+1, 4*m) ~ 'Asymptomatic',
status %in% seq(4*m+1, 5*m) ~ 'Infectious',
status %in% seq(5*m+1, 6*m) ~ 'Recovered')) %>%
mutate(status = fct_relevel(status, "Susceptible", 'Exposed', 'Pre-symptomatic',
'Asymptomatic', 'Infectious', 'Recovered')) %>%
change_col('group')
df <- out %>%
pivot_longer(
cols = -1,
names_to = 'group',
values_to = 'value'
) %>%
mutate(group = as.numeric(group),
status = group) %>%
mutate(status = case_when(status %in% seq(1,       m) ~ 'Susceptible',
status %in% seq(m+1,   2*m) ~ 'Exposed',
status %in% seq(2*m+1, 3*m) ~ 'Pre-symptomatic',
status %in% seq(3*m+1, 4*m) ~ 'Asymptomatic',
status %in% seq(4*m+1, 5*m) ~ 'Infectious',
status %in% seq(5*m+1, 6*m) ~ 'Recovered')) %>%
mutate(status = fct_relevel(status, "Susceptible", 'Exposed', 'Pre-symptomatic',
'Asymptomatic', 'Infectious', 'Recovered')) %>%
change_col(group)
seq(1, 5*28+1, 28)
change_col <- function(data, col) {
for (i in 1:28) {
data %>%
mutate({{col}} = case_when({{col}} %in% seq(i, 5*28+i, 28) ~ str_glue('age{age_id[i]}_vac{vac_id[i]}')))
}
}
data %>%
mutate(({{col}}) = case_when(({{col}}) %in% seq(i, 5*28+i, 28) ~ str_glue('age{age_id[i]}_vac{vac_id[i]}')))
change_col <- function(data, group) {
for (i in 1:28) {
data %>%
mutate(group = case_when(group %in% seq(i, 5*28+i, 28) ~ str_glue('age{age_id[i]}_vac{vac_id[i]}')))
}
}
df <- out %>%
pivot_longer(
cols = -1,
names_to = 'group',
values_to = 'value'
) %>%
mutate(group = as.numeric(group),
status = group) %>%
mutate(status = case_when(status %in% seq(1,       m) ~ 'Susceptible',
status %in% seq(m+1,   2*m) ~ 'Exposed',
status %in% seq(2*m+1, 3*m) ~ 'Pre-symptomatic',
status %in% seq(3*m+1, 4*m) ~ 'Asymptomatic',
status %in% seq(4*m+1, 5*m) ~ 'Infectious',
status %in% seq(5*m+1, 6*m) ~ 'Recovered')) %>%
mutate(status = fct_relevel(status, "Susceptible", 'Exposed', 'Pre-symptomatic',
'Asymptomatic', 'Infectious', 'Recovered')) %>%
change_col()
df <- out %>%
pivot_longer(
cols = -1,
names_to = 'group',
values_to = 'value'
) %>%
mutate(group = as.numeric(group),
status = group) %>%
mutate(status = case_when(status %in% seq(1,       m) ~ 'Susceptible',
status %in% seq(m+1,   2*m) ~ 'Exposed',
status %in% seq(2*m+1, 3*m) ~ 'Pre-symptomatic',
status %in% seq(3*m+1, 4*m) ~ 'Asymptomatic',
status %in% seq(4*m+1, 5*m) ~ 'Infectious',
status %in% seq(5*m+1, 6*m) ~ 'Recovered')) %>%
mutate(status = fct_relevel(status, "Susceptible", 'Exposed', 'Pre-symptomatic',
'Asymptomatic', 'Infectious', 'Recovered')) %>%
change_col(group = group)
change_col <- function(data, group) {
for (i in 1:28) {
data %>%
mutate(.data[[group]] = case_when(.data[[group]] %in% seq(i, 5*28+i, 28) ~ str_glue('age{age_id[i]}_vac{vac_id[i]}')))
}
}
change_col <- function(data, col) {
for (i in 1:28) {
data %>%
mutate(.data[[col]] = case_when(.data[[col]] %in% seq(i, 5*28+i, 28) ~ str_glue('age{age_id[i]}_vac{vac_id[i]}')))
}
}
change_col <- function(data, col) {
for (i in 1:28) {
data %>%
mutate(.data[['col']] = case_when(.data[['col']] %in% seq(i, 5*28+i, 28) ~ str_glue('age{age_id[i]}_vac{vac_id[i]}')))
}
}
change_col <- function(data, col) {
for (i in 1:28) {
data %>%
mutate(.data$col = case_when(.data$col %in% seq(i, 5*28+i, 28) ~ str_glue('age{age_id[i]}_vac{vac_id[i]}')))
}
}
change_col <- function(data, col) {
data %>% for (i in 1:28) {
mutate(.data$col = case_when(.data$col %in% seq(i, 5*28+i, 28) ~ str_glue('age{age_id[i]}_vac{vac_id[i]}')))
}
}
change_col <- function(data, col) for (i in 1:28) {{
data %>%
mutate(.data$col = case_when(.data$col %in% seq(i, 5*28+i, 28) ~ str_glue('age{age_id[i]}_vac{vac_id[i]}')))
}
}
df <- out %>%
pivot_longer(
cols = -1,
names_to = 'group',
values_to = 'value'
) %>%
mutate(group = as.numeric(group),
status = group) %>%
mutate(status = case_when(status %in% seq(1,       m) ~ 'Susceptible',
status %in% seq(m+1,   2*m) ~ 'Exposed',
status %in% seq(2*m+1, 3*m) ~ 'Pre-symptomatic',
status %in% seq(3*m+1, 4*m) ~ 'Asymptomatic',
status %in% seq(4*m+1, 5*m) ~ 'Infectious',
status %in% seq(5*m+1, 6*m) ~ 'Recovered')) %>%
mutate(status = fct_relevel(status, "Susceptible", 'Exposed', 'Pre-symptomatic',
'Asymptomatic', 'Infectious', 'Recovered'))
for (i in 1:28) {
df %>%
mutate(group = case_when(group %in% seq(i, 5*28+i, 28) ~ str_glue('age{age_id[i]}_vac{vac_id[i]}')))
}
head(df)
'str_glue('age{age_id[1]}_vac{vac_id[1]}')'
c(str_glue('age{age_id[1]}_vac{vac_id[1]}'))
df <- out %>%
pivot_longer(
cols = -1,
names_to = 'group',
values_to = 'value'
) %>%
mutate(group = as.numeric(group),
status = group) %>%
mutate(status = case_when(status %in% seq(1,       m) ~ 'Susceptible',
status %in% seq(m+1,   2*m) ~ 'Exposed',
status %in% seq(2*m+1, 3*m) ~ 'Pre-symptomatic',
status %in% seq(3*m+1, 4*m) ~ 'Asymptomatic',
status %in% seq(4*m+1, 5*m) ~ 'Infectious',
status %in% seq(5*m+1, 6*m) ~ 'Recovered')) %>%
mutate(status = fct_relevel(status, "Susceptible", 'Exposed', 'Pre-symptomatic',
'Asymptomatic', 'Infectious', 'Recovered'))
for (i in 1:28) {
df %>%
mutate(group = replace(group, group %in% seq(i, 5*28+i, 28), c(str_glue('age{age_id[i]}_vac{vac_id[i]}'))))
# mutate(group = case_when(group %in% seq(i, 5*28+i, 28) ~ c(str_glue('age{age_id[i]}_vac{vac_id[i]}'))))
}
head(df)
tail(df)
df %>%
# mutate(group = replace(group, group %in% seq(i, 5*28+i, 28), c(str_glue('age{age_id[i]}_vac{vac_id[i]}'))))
mutate(group = case_when(group %in% seq(i, 5*28+i, 28) ~ c(str_glue('age{age_id[i]}_vac{vac_id[i]}'))))
df <- out %>%
pivot_longer(
cols = -1,
names_to = 'group',
values_to = 'value'
) %>%
mutate(group = as.numeric(group),
status = group) %>%
mutate(status = case_when(status %in% seq(1,       m) ~ 'Susceptible',
status %in% seq(m+1,   2*m) ~ 'Exposed',
status %in% seq(2*m+1, 3*m) ~ 'Pre-symptomatic',
status %in% seq(3*m+1, 4*m) ~ 'Asymptomatic',
status %in% seq(4*m+1, 5*m) ~ 'Infectious',
status %in% seq(5*m+1, 6*m) ~ 'Recovered')) %>%
mutate(status = fct_relevel(status, "Susceptible", 'Exposed', 'Pre-symptomatic',
'Asymptomatic', 'Infectious', 'Recovered')) %>%
mutate(id = group)
df %>%
mutate(id = replace(id, group %in% seq(i, 5*28+i, 28), c(str_glue('age{age_id[i]}_vac{vac_id[i]}'))))
df <- out %>%
pivot_longer(
cols = -1,
names_to = 'group',
values_to = 'value'
) %>%
mutate(group = as.numeric(group),
status = group) %>%
mutate(status = case_when(status %in% seq(1,       m) ~ 'Susceptible',
status %in% seq(m+1,   2*m) ~ 'Exposed',
status %in% seq(2*m+1, 3*m) ~ 'Pre-symptomatic',
status %in% seq(3*m+1, 4*m) ~ 'Asymptomatic',
status %in% seq(4*m+1, 5*m) ~ 'Infectious',
status %in% seq(5*m+1, 6*m) ~ 'Recovered')) %>%
mutate(status = fct_relevel(status, "Susceptible", 'Exposed', 'Pre-symptomatic',
'Asymptomatic', 'Infectious', 'Recovered')) %>%
mutate(id = group) %>%
mutate(id = replace(id, group %in% seq(1, 5*28+1, 28), c(str_glue('age{age_id[1]}_vac{vac_id[1]}'))))
head(df)
df <- out %>%
pivot_longer(
cols = -1,
names_to = 'group',
values_to = 'value'
) %>%
mutate(group = as.numeric(group),
status = group) %>%
mutate(status = case_when(status %in% seq(1,       m) ~ 'Susceptible',
status %in% seq(m+1,   2*m) ~ 'Exposed',
status %in% seq(2*m+1, 3*m) ~ 'Pre-symptomatic',
status %in% seq(3*m+1, 4*m) ~ 'Asymptomatic',
status %in% seq(4*m+1, 5*m) ~ 'Infectious',
status %in% seq(5*m+1, 6*m) ~ 'Recovered')) %>%
mutate(status = fct_relevel(status, "Susceptible", 'Exposed', 'Pre-symptomatic',
'Asymptomatic', 'Infectious', 'Recovered')) %>%
mutate(id = group) %>%
mutate(id = replace(id, group %in% seq(1, 5*28+1, 28), c(str_glue('age{age_id[1]}_vac{vac_id[1]}')))) %>%
mutate(id = replace(id, group %in% seq(2, 5*28+2, 28), c(str_glue('age{age_id[2]}_vac{vac_id[2]}'))))
head(df)
?mutate_all
df <- out %>%
pivot_longer(
cols = -1,
names_to = 'group',
values_to = 'value'
) %>%
mutate(group = as.numeric(group),
status = group) %>%
mutate(status = case_when(status %in% seq(1,       m) ~ 'Susceptible',
status %in% seq(m+1,   2*m) ~ 'Exposed',
status %in% seq(2*m+1, 3*m) ~ 'Pre-symptomatic',
status %in% seq(3*m+1, 4*m) ~ 'Asymptomatic',
status %in% seq(4*m+1, 5*m) ~ 'Infectious',
status %in% seq(5*m+1, 6*m) ~ 'Recovered')) %>%
mutate(status = fct_relevel(status, "Susceptible", 'Exposed', 'Pre-symptomatic',
'Asymptomatic', 'Infectious', 'Recovered')) %>%
mutate(id = group)
df$id[seq(1, 5*28+1, 28)]
df$id[seq(1, 5*28+1, 28)] <- c(str_glue('age{age_id[1]}_vac{vac_id[1]}'))))
df[id]
df['id'][seq(1, 5*28+1, 28)]
head(df)
df['id']
df['id' %in% seq(1, 5*28+1, 28)]
df[df$id %in% seq(1, 5*28+1, 28)]
df[df$id %in% c(seq(1, 5*28+1, 28))]
c(seq(1, 5*28+1, 28))
df[df$id %in% c(1, 29)]
df[df$id %in% c(seq(1, 5*28+1, 28)), ]
df[df$id %in% c(seq(1, 5*28+1, 28)), id]
df[df$id %in% c(seq(1, 5*28+1, 28)), 'id']
df[df$id %in% c(seq(1, 5*28+1, 28)), 'id'] <- c(str_glue('age{age_id[1]}_vac{vac_id[1]}'))
c(str_glue('age{age_id[1]}_vac{vac_id[1]}'))
df[df$id %in% c(seq(1, 5*28+1, 28)), 'id'] <- NA
df[df$id %in% c(seq(1, 5*28+1, 28)), 'id'] <- c(str_glue('age{age_id[1]}_vac{vac_id[1]}'))
df[df$id %in% c(seq(1, 5*28+1, 28)), 'id']
df <- out %>%
pivot_longer(
cols = -1,
names_to = 'group',
values_to = 'value'
) %>%
mutate(group = as.numeric(group),
status = group) %>%
mutate(status = case_when(status %in% seq(1,       m) ~ 'Susceptible',
status %in% seq(m+1,   2*m) ~ 'Exposed',
status %in% seq(2*m+1, 3*m) ~ 'Pre-symptomatic',
status %in% seq(3*m+1, 4*m) ~ 'Asymptomatic',
status %in% seq(4*m+1, 5*m) ~ 'Infectious',
status %in% seq(5*m+1, 6*m) ~ 'Recovered')) %>%
mutate(status = fct_relevel(status, "Susceptible", 'Exposed', 'Pre-symptomatic',
'Asymptomatic', 'Infectious', 'Recovered')) %>%
mutate(id = group)
df[df$id %in% c(seq(1, 5*28+1, 28)), ] <- NA
head(DF)
head(df)
df <- out %>%
pivot_longer(
cols = -1,
names_to = 'group',
values_to = 'value'
) %>%
mutate(group = as.numeric(group),
status = group) %>%
mutate(status = case_when(status %in% seq(1,       m) ~ 'Susceptible',
status %in% seq(m+1,   2*m) ~ 'Exposed',
status %in% seq(2*m+1, 3*m) ~ 'Pre-symptomatic',
status %in% seq(3*m+1, 4*m) ~ 'Asymptomatic',
status %in% seq(4*m+1, 5*m) ~ 'Infectious',
status %in% seq(5*m+1, 6*m) ~ 'Recovered')) %>%
mutate(status = fct_relevel(status, "Susceptible", 'Exposed', 'Pre-symptomatic',
'Asymptomatic', 'Infectious', 'Recovered')) %>%
mutate(id = group)
df[df$id %in% c(seq(1, 5*28+1, 28)), 'id'] <- NA
head(df)
df[df$id %in% c(seq(1, 5*28+1, 28)), 'id'] <- c('age1')
df <- out %>%
pivot_longer(
cols = -1,
names_to = 'group',
values_to = 'value'
) %>%
mutate(group = as.numeric(group),
status = group) %>%
mutate(status = case_when(status %in% seq(1,       m) ~ 'Susceptible',
status %in% seq(m+1,   2*m) ~ 'Exposed',
status %in% seq(2*m+1, 3*m) ~ 'Pre-symptomatic',
status %in% seq(3*m+1, 4*m) ~ 'Asymptomatic',
status %in% seq(4*m+1, 5*m) ~ 'Infectious',
status %in% seq(5*m+1, 6*m) ~ 'Recovered')) %>%
mutate(status = fct_relevel(status, "Susceptible", 'Exposed', 'Pre-symptomatic',
'Asymptomatic', 'Infectious', 'Recovered')) %>%
mutate(id = as.character(group))
df[df$id %in% c(seq(1, 5*28+1, 28)), 'id'] <- c('age1')
head(df)
df <- out %>%
pivot_longer(
cols = -1,
names_to = 'group',
values_to = 'value'
) %>%
mutate(group = as.numeric(group),
status = group) %>%
mutate(status = case_when(status %in% seq(1,       m) ~ 'Susceptible',
status %in% seq(m+1,   2*m) ~ 'Exposed',
status %in% seq(2*m+1, 3*m) ~ 'Pre-symptomatic',
status %in% seq(3*m+1, 4*m) ~ 'Asymptomatic',
status %in% seq(4*m+1, 5*m) ~ 'Infectious',
status %in% seq(5*m+1, 6*m) ~ 'Recovered')) %>%
mutate(status = fct_relevel(status, "Susceptible", 'Exposed', 'Pre-symptomatic',
'Asymptomatic', 'Infectious', 'Recovered')) %>%
mutate(id = as.character(group))
for (i in 1:28) {
df[df$id %in% c(seq(i, 5*28+i, 28)), 'id'] <- c(str_glue('age{age_id[i]}_vac{vac_id[i]}'))
# mutate(id = replace(id, group %in% seq(i, 5*28+i, 28), c(str_glue('age{age_id[i]}_vac{vac_id[i]}'))))
# mutate(group = case_when(group %in% seq(i, 5*28+i, 28) ~ c(str_glue('age{age_id[i]}_vac{vac_id[i]}'))))
}
head(df)
tail(df)
m
df <- out %>%
pivot_longer(
cols = -1,
names_to = 'group',
values_to = 'value'
) %>%
mutate(status = as.numeric(group)) %>%
mutate(status = case_when(status %in% seq(1,       m) ~ 'Susceptible',
status %in% seq(m+1,   2*m) ~ 'Exposed',
status %in% seq(2*m+1, 3*m) ~ 'Pre-symptomatic',
status %in% seq(3*m+1, 4*m) ~ 'Asymptomatic',
status %in% seq(4*m+1, 5*m) ~ 'Infectious',
status %in% seq(5*m+1, 6*m) ~ 'Recovered')) %>%
mutate(status = fct_relevel(status, "Susceptible", 'Exposed', 'Pre-symptomatic',
'Asymptomatic', 'Infectious', 'Recovered'))
head(df)
class(df)
class(out)
df <- for (i in 1:28) {
df[df$group %in% c(seq(i, 5*m+i, m)), 'group'] <- c(str_glue('age{age_id[i]}_vac{vac_id[i]}'))
}
head(df)
df <- out %>%
pivot_longer(
cols = -1,
names_to = 'group',
values_to = 'value'
) %>%
mutate(status = as.numeric(group)) %>%
mutate(status = case_when(status %in% seq(1,       m) ~ 'Susceptible',
status %in% seq(m+1,   2*m) ~ 'Exposed',
status %in% seq(2*m+1, 3*m) ~ 'Pre-symptomatic',
status %in% seq(3*m+1, 4*m) ~ 'Asymptomatic',
status %in% seq(4*m+1, 5*m) ~ 'Infectious',
status %in% seq(5*m+1, 6*m) ~ 'Recovered')) %>%
mutate(status = fct_relevel(status, "Susceptible", 'Exposed', 'Pre-symptomatic',
'Asymptomatic', 'Infectious', 'Recovered'))
for (i in 1:28) {
df[df$group %in% c(seq(i, 5*m+i, m)), 'group'] <- c(str_glue('age{age_id[i]}_vac{vac_id[i]}'))
}
head(df)
sele_w <- df %>%
filter(status %in% c('Asymptomatic', 'Infectious')) %>%
pivot_wider(names_from = 'status',
values_from = 'value') %>%
mutate(I_A = Asymptomatic + Infectious) %>%
separate(group, into = c('age_group', 'vac_group'), sep = '_') %>%
mutate(across(.cols = contains('group'),
.fns  = as.factor)) %>%
mutate(vac_group = fct_relevel(vac_group, 'vac4', 'vac3', 'vac2', 'vac1')) %>%
mutate(scenario = 'w')
head(sele_w)
