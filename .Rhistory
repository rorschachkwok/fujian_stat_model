group %in% seq(17, 157, 28) ~ 'age5_vac1',
group %in% seq(18, 158, 28) ~ 'age5_vac2',
group %in% seq(19, 159, 28) ~ 'age5_vac3',
group %in% seq(20, 160, 28) ~ 'age5_vac4',
group %in% seq(21, 161, 28) ~ 'age6_vac1',
group %in% seq(22, 162, 28) ~ 'age6_vac2',
group %in% seq(23, 163, 28) ~ 'age6_vac3',
group %in% seq(24, 164, 28) ~ 'age6_vac4',
group %in% seq(25, 165, 28) ~ 'age7_vac1',
group %in% seq(26, 166, 28) ~ 'age7_vac2',
group %in% seq(27, 167, 28) ~ 'age7_vac3',
group %in% seq(28, 168, 28) ~ 'age7_vac4'))
sele_f <- cut_f %>%
filter(status %in% c('Asymptomatic', 'Infectious')) %>%
pivot_wider(names_from = 'status',
values_from = 'value') %>%
mutate(I_A = Asymptomatic + Infectious) %>%
separate(group, into = c('age_group', 'vac_group'), sep = '_') %>%
mutate(across(.cols = contains('group'),
.fns  = as.factor)) %>%
mutate(vac_group = fct_relevel(vac_group, 'vac4', 'vac3', 'vac2', 'vac1')) %>%
mutate(scenario = 'c_f')
wsf <- bind_rows(sele_w, sele_s)
wsf <- bind_rows(wsf, sele_f)
wsf <- wsf %>%
mutate(scenario = as.factor(scenario)) %>%
mutate(scenario = fct_relevel(scenario, 'w', 'c_s', 'c_f'))
# plot
facet_label <- c('Whole population', 'Close school', 'Close factory')
facet_hide <- levels(wsf$scenario)
names(facet_label) <- facet_hide
ag1 <- wsf %>%
filter(age_group == 'age1') %>%
ggplot(aes(x = time, y= I_A, color = vac_group)) +
geom_line() +
scale_y_continuous(
expand = expansion(0),
labels = comma
)+
scale_x_continuous(
expand = expansion(0),
breaks = seq(0, 300, 50),
labels = seq(0, 300, 50)
)+
scale_color_manual(values = c(
"#43b284","#0f7ba2","#fab255","#dd5129"),
labels = c('14-30 days since 2nd dose',
'31-60 days since 2nd dose',
'60+ days since 2nd dose',
'At most partilly vaccinated')) +
theme_classic()+
theme(axis.title = element_text(face = 'bold'),
# legend.position = 'top',
# legend.justification = 'left',
# legend.key.width = unit(1, 'cm'),
# legend.text = element_text(size = 12),
legend.spacing.x=unit(0.1,'cm'), # 定义文本水平距离
legend.key.width=unit(1.5,'cm'), # 定义图例水平大小
legend.key.height=unit(0.5,'cm'), # 定义图例垂直大小
legend.background=element_blank(), # 设置背景为空
# legend.box.background=element_rect(colour = "black",linetype = "solid"), # 图例绘制边框
legend.box.margin = margin(1,1,1,1),
legend.position = 'top',
legend.text = element_text(size = 10),
legend.justification = c(0, 1),
# plot.title = element_text(face = 'bold', hjust = 0.5, size = 5),
strip.text = element_text(hjust = 0.5, face = 'bold', size = 12),
strip.background = element_rect(color = 'white'))+
labs(
x = NULL,
y = "0-9 years old",
color = NULL)+
facet_grid(cols = vars(scenario), scales =  "free_y",
labeller = labeller(scenario = facet_label))+
guides(color = guide_legend(nrow=2,byrow=TRUE))
ag2 <- wsf %>%
filter(age_group == 'age2') %>%
ggplot(aes(x = time, y= I_A, color = vac_group)) +
geom_line() +
scale_y_continuous(
expand = expansion(0),
labels = comma
)+
scale_x_continuous(
expand = expansion(0),
breaks = seq(0, 300, 50),
labels = seq(0, 300, 50)
)+
scale_color_manual(values = c(
"#43b284","#0f7ba2","#fab255","#dd5129"),
labels = c('14-30 days since 2nd dose',
'31-60 days since 2nd dose',
'60+ days since 2nd dose',
'At most partilly vaccinated')) +
theme_classic()+
theme(axis.title = element_text(face = 'bold'),
# legend.position = 'top',
# legend.justification = 'left',
# legend.key.width = unit(1, 'cm'),
# legend.text = element_text(size = 12),
legend.spacing.x=unit(0.1,'cm'), # 定义文本水平距离
legend.key.width=unit(1.5,'cm'), # 定义图例水平大小
legend.key.height=unit(0.5,'cm'), # 定义图例垂直大小
legend.background=element_blank(), # 设置背景为空
# legend.box.background=element_rect(colour = "black",linetype = "solid"), # 图例绘制边框
legend.box.margin = margin(1,1,1,1),
legend.position = 'none',
legend.text = element_text(size = 10),
legend.justification = c(0, 1),
# plot.title = element_text(face = 'bold', hjust = 0.5, size = 5),
strip.text = element_blank(),
strip.background = element_rect(color = 'white'))+
labs(
x = NULL,
y = "10-19 years old",
color = NULL)+
facet_grid(cols = vars(scenario), scales =  "free_y",
labeller = labeller(scenario = facet_label))
ag3 <- wsf %>%
filter(age_group == 'age3') %>%
ggplot(aes(x = time, y= I_A, color = vac_group)) +
geom_line() +
scale_y_continuous(
expand = expansion(0),
labels = comma
)+
scale_x_continuous(
expand = expansion(0),
breaks = seq(0, 300, 50),
labels = seq(0, 300, 50)
)+
scale_color_manual(values = c(
"#43b284","#0f7ba2","#fab255","#dd5129"),
labels = c('14-30 days since 2nd dose',
'31-60 days since 2nd dose',
'60+ days since 2nd dose',
'At most partilly vaccinated')) +
theme_classic()+
theme(axis.title = element_text(face = 'bold'),
# legend.position = 'top',
# legend.justification = 'left',
# legend.key.width = unit(1, 'cm'),
# legend.text = element_text(size = 12),
legend.spacing.x=unit(0.1,'cm'), # 定义文本水平距离
legend.key.width=unit(1.5,'cm'), # 定义图例水平大小
legend.key.height=unit(0.5,'cm'), # 定义图例垂直大小
legend.background=element_blank(), # 设置背景为空
# legend.box.background=element_rect(colour = "black",linetype = "solid"), # 图例绘制边框
legend.box.margin = margin(1,1,1,1),
legend.position = 'none',
legend.text = element_text(size = 10),
legend.justification = c(0, 1),
# plot.title = element_text(face = 'bold', hjust = 0.5, size = 5),
strip.text = element_blank(),
strip.background = element_rect(color = 'white'))+
labs(
x = NULL,
y = "20-29 years old",
color = NULL)+
facet_grid(cols = vars(scenario), scales =  "free_y",
labeller = labeller(scenario = facet_label))
ag4 <- wsf %>%
filter(age_group == 'age4') %>%
ggplot(aes(x = time, y= I_A, color = vac_group)) +
geom_line() +
scale_y_continuous(
expand = expansion(0),
labels = comma
# limits=c(0, 1260000),
# breaks=seq(0,1250000,by=250000)
)+
scale_x_continuous(
expand = expansion(0),
breaks = seq(0, 300, 50),
labels = seq(0, 300, 50)
)+
scale_color_manual(values = c(
"#43b284","#0f7ba2","#fab255","#dd5129"),
labels = c('14-30 days since 2nd dose',
'31-60 days since 2nd dose',
'60+ days since 2nd dose',
'At most partilly vaccinated')) +
theme_classic()+
theme(axis.title = element_text(face = 'bold'),
# legend.position = 'top',
# legend.justification = 'left',
# legend.key.width = unit(1, 'cm'),
# legend.text = element_text(size = 12),
legend.spacing.x=unit(0.1,'cm'), # 定义文本水平距离
legend.key.width=unit(1.5,'cm'), # 定义图例水平大小
legend.key.height=unit(0.5,'cm'), # 定义图例垂直大小
legend.background=element_blank(), # 设置背景为空
# legend.box.background=element_rect(colour = "black",linetype = "solid"), # 图例绘制边框
legend.box.margin = margin(1,1,1,1),
legend.position = 'none',
legend.text = element_text(size = 10),
legend.justification = c(0, 1),
# plot.title = element_text(face = 'bold', hjust = 0.5, size = 5),
strip.text = element_blank(),
strip.background = element_rect(color = 'white'))+
labs(
x = NULL,
y = "30-39 years old",
color = NULL)+
facet_grid(cols = vars(scenario), scales =  "fixed",
labeller = labeller(scenario = facet_label))
ag5 <- wsf %>%
filter(age_group == 'age5') %>%
ggplot(aes(x = time, y= I_A, color = vac_group)) +
geom_line() +
scale_y_continuous(
expand = expansion(0),
labels = comma
)+
scale_x_continuous(
expand = expansion(0),
breaks = seq(0, 300, 50),
labels = seq(0, 300, 50)
)+
scale_color_manual(values = c(
"#43b284","#0f7ba2","#fab255","#dd5129"),
labels = c('14-30 days since 2nd dose',
'31-60 days since 2nd dose',
'60+ days since 2nd dose',
'At most partilly vaccinated')) +
theme_classic()+
theme(axis.title = element_text(face = 'bold'),
# legend.position = 'top',
# legend.justification = 'left',
# legend.key.width = unit(1, 'cm'),
# legend.text = element_text(size = 12),
legend.spacing.x=unit(0.1,'cm'), # 定义文本水平距离
legend.key.width=unit(1.5,'cm'), # 定义图例水平大小
legend.key.height=unit(0.5,'cm'), # 定义图例垂直大小
legend.background=element_blank(), # 设置背景为空
# legend.box.background=element_rect(colour = "black",linetype = "solid"), # 图例绘制边框
legend.box.margin = margin(1,1,1,1),
legend.position = 'none',
legend.text = element_text(size = 10),
legend.justification = c(0, 1),
# plot.title = element_text(face = 'bold', hjust = 0.5, size = 5),
strip.text = element_blank(),
strip.background = element_rect(color = 'white'))+
labs(
x = NULL,
y = "40-49 years old",
color = NULL)+
facet_grid(cols = vars(scenario), scales =  "fixed",
labeller = labeller(scenario = facet_label))
ag6 <- wsf %>%
filter(age_group == 'age6') %>%
ggplot(aes(x = time, y= I_A, color = vac_group)) +
geom_line() +
scale_y_continuous(
expand = expansion(0),
labels = comma
)+
scale_x_continuous(
expand = expansion(0),
breaks = seq(0, 300, 50),
labels = seq(0, 300, 50)
)+
scale_color_manual(values = c(
"#43b284","#0f7ba2","#fab255","#dd5129"),
labels = c('14-30 days since 2nd dose',
'31-60 days since 2nd dose',
'60+ days since 2nd dose',
'At most partilly vaccinated')) +
theme_classic()+
theme(axis.title = element_text(face = 'bold'),
# legend.position = 'top',
# legend.justification = 'left',
# legend.key.width = unit(1, 'cm'),
# legend.text = element_text(size = 12),
legend.spacing.x=unit(0.1,'cm'), # 定义文本水平距离
legend.key.width=unit(1.5,'cm'), # 定义图例水平大小
legend.key.height=unit(0.5,'cm'), # 定义图例垂直大小
legend.background=element_blank(), # 设置背景为空
# legend.box.background=element_rect(colour = "black",linetype = "solid"), # 图例绘制边框
legend.box.margin = margin(1,1,1,1),
legend.position = 'none',
legend.text = element_text(size = 10),
legend.justification = c(0, 1),
# plot.title = element_text(face = 'bold', hjust = 0.5, size = 5),
strip.text = element_blank(),
strip.background = element_rect(color = 'white'))+
labs(
x = NULL,
y = "50-59 years old",
color = NULL)+
facet_grid(cols = vars(scenario), scales =  "fixed",
labeller = labeller(scenario = facet_label))
ag7 <- wsf %>%
filter(age_group == 'age7') %>%
ggplot(aes(x = time, y= I_A, color = vac_group)) +
geom_line() +
scale_y_continuous(
expand = expansion(0),
labels = comma
)+
scale_x_continuous(
expand = expansion(0),
breaks = seq(0, 300, 50),
labels = seq(0, 300, 50)
)+
scale_color_manual(values = c(
"#43b284","#0f7ba2","#fab255","#dd5129"),
labels = c('14-30 days since 2nd dose',
'31-60 days since 2nd dose',
'60+ days since 2nd dose',
'At most partilly vaccinated')) +
theme_classic()+
theme(axis.title = element_text(face = 'bold'),
# legend.position = 'top',
# legend.justification = 'left',
# legend.key.width = unit(1, 'cm'),
# legend.text = element_text(size = 12),
legend.spacing.x=unit(0.1,'cm'), # 定义文本水平距离
legend.key.width=unit(1.5,'cm'), # 定义图例水平大小
legend.key.height=unit(0.5,'cm'), # 定义图例垂直大小
legend.background=element_blank(), # 设置背景为空
# legend.box.background=element_rect(colour = "black",linetype = "solid"), # 图例绘制边框
legend.box.margin = margin(1,1,1,1),
legend.position = 'none',
legend.text = element_text(size = 10),
legend.justification = c(0, 1),
# plot.title = element_text(face = 'bold', hjust = 0.5, size = 5),
strip.text = element_blank(),
strip.background = element_rect(color = 'white'))+
labs(
x = 'Time (days)',
y = "60+ years old",
color = NULL)+
facet_grid(cols = vars(scenario), scales =  "fixed")
patchwork <- ag1/
ag2/
ag3/
ag4/
ag5/
ag6/
ag7
ggsave('vec_test_delta.pdf', height = 12, width = 8, dpi = 300)
as.list(c(INPUT, parms)
)
as.list(INPUT, parms)
as.list(c(parms))
parms
as.list(INPUT)
as.list(c(INPUT))
as.list(INPUT, parms)
c(INPUT,parms)
as.list?()
?as.list()
?c()
pacman::p_load(
rstatix,
openxlsx,
coin,
epikit,
tidyverse
)
df <- read.xlsx('cleaned_data.xlsx')
cat_ll <- df %>%
mutate(
age_cat = age_categories(             # create new column
age,                            # numeric column to make groups from
breakers = c(0, 10,  20,        # break points
30, 40, 50, 60)),
index_age_cat = age_categories(             # create new column
index_age,                            # numeric column to make groups from
breakers = c(0, 10,  20,        # break points
30, 40, 50, 60))) %>%
mutate(vac_history = replace(vac_history, vac_history == 1, 0))
table(cat_ll$age_cat)
# select positive and fully vaccinated in close contacts
sele <- cat_ll %>%
filter(outcome == 1) %>%
filter(vac_history == 2) %>%
mutate(days_vac_exposure = as.numeric(days_vac_exposure))
View(sele)
group_by(age_cat) %>%
summarise(iqr2 = median(days_vac_exposure),
iqr1 = quantile(days_vac_exposure, probs = 0.25),
iqr3 = quantile(days_vac_exposure, probs = 0.75))
table(cat_ll$age_cat)
# select positive and fully vaccinated in close contacts
sele <- cat_ll %>%
filter(outcome == 1) %>%
filter(vac_history == 2) %>%
mutate(days_vac_exposure = as.numeric(days_vac_exposure))
# select positive and fully vaccinated in close contacts
sele <- cat_ll %>%
filter(outcome == 1) %>%
filter(vac_history == 2) %>%
mutate(days_vac_exposure = as.numeric(days_vac_exposure)) %>%
group_by(age_cat) %>%
summarise(iqr2 = median(days_vac_exposure),
iqr1 = quantile(days_vac_exposure, probs = 0.25),
iqr3 = quantile(days_vac_exposure, probs = 0.75))
# select positive and fully vaccinated in close contacts
sele <- cat_ll %>%
filter(outcome == 1) %>%
filter(vac_history == 2) %>%
mutate(days_vac_exposure = as.numeric(days_vac_exposure)) %>%
# group_by(age_cat) %>%
summarise(iqr2 = median(days_vac_exposure),
iqr1 = quantile(days_vac_exposure, probs = 0.25),
iqr3 = quantile(days_vac_exposure, probs = 0.75))
median_test(days_vac_exposure ~ age_cat, mid.score = '0.5', data = sele)
# select positive and fully vaccinated in close contacts
sele <- cat_ll %>%
filter(outcome == 1) %>%
filter(vac_history == 2) %>%
mutate(days_vac_exposure = as.numeric(days_vac_exposure))
median_test(days_vac_exposure ~ age_cat, mid.score = '0.5', data = sele)
median_test(days_vac_exposure ~ age_cat, mid.score = '0.5', data = sele)
# select positive outcome close contacts
sele_p <- cat_ll %>%
filter(outcome == 1) %>%
mutate(across(.cols = c(vac_history, gender, clnc_outcome),
.fns = as.factor))
sele_p %>%
filter(vac_history == 2) %>%
t_test(days_vac_exposure ~ age_cat)
chisq.test(sele_p$gender, sele_p$vac_history)
chisq.test(sele_p$vac_history, sele_p$gender)
chisq.test(sele_p$gender, sele_p$vac_history, simulate.p.value = T)
sele_n <- cat_ll %>%
filter(outcome == 0) %>%
mutate(across(.cols = c(vac_history, gender, clnc_outcome),
.fns = as.factor))
table(sele_n$vac_history)
chisq.test(sele_n$gender, sele_n$vac_history)
median_test(days_vac_exposure ~ age_cat, mid.score = '0.5', data = sele)
median_test(days_vac_exposure ~ age_cat, data = sele)
chisq.test(sele_p$clnc_outcome, sele_p$vac_history, simulate.p.value = T)
chisq.test(sele_p$clnc_outcome, sele_p$vac_history, simulate.p.value = T)
sele_n <- cat_ll %>%
filter(outcome == 0) %>%
mutate(across(.cols = c(vac_history, gender, clnc_outcome),
.fns = as.factor))
sele_n %>%
t_test(age ~ vac_history)
median_test(age ~ vac_history,  data = sele_n)
median_test(age ~ vac_history, mid.score = '0.5', data = sele_p)
median_test(days_vac_exposure ~ age_cat, mid.score = '0.5', data = sele)
chisq.test(sele_n$gender, sele_n$vac_history)
sele_n %>%
filter(vac_history == 2) %>%
# filter(age_cat != '0-9') %>%
t_test(age_cat ~ days_vac_exposure)
pacman::p_load(
rstatix,
openxlsx,
coin,
epikit,
tidyverse
)
df <- read.xlsx('cleaned_data.xlsx')
# make age groups, vac status classify as at most partially and fully
cat_ll <- df %>%
mutate(
age_cat = age_categories(             # create new column
age,                            # numeric column to make groups from
breakers = c(0, 10,  20,        # break points
30, 40, 50, 60)),
index_age_cat = age_categories(             # create new column
index_age,                            # numeric column to make groups from
breakers = c(0, 10,  20,        # break points
30, 40, 50, 60))) %>%
mutate(vac_history = replace(vac_history, vac_history == 1, 0))
# select positive and fully vaccinated in close contacts
sele <- cat_ll %>%
filter(outcome == 1) %>%
filter(vac_history == 2) %>%
mutate(days_vac_exposure = as.numeric(days_vac_exposure))
# group_by(age_cat) %>%
# summarise(iqr2 = median(days_vac_exposure),
#           iqr1 = quantile(days_vac_exposure, probs = 0.25),
#           iqr3 = quantile(days_vac_exposure, probs = 0.75))
kruskal.test(age ~ vac_history, sele)
class(sele$age)
# select positive outcome close contacts
sele_p <- cat_ll %>%
filter(outcome == 1) %>%
mutate(across(.cols = c(vac_history, gender, clnc_outcome),
.fns = as.factor))
wilcox.test(age ~ vac_history, sele_p)
median_test(age ~ vac_history, mid.score = '0.5', data = sele_p)
# group_by(age_cat) %>%
# summarise(iqr2 = median(days_vac_exposure),
#           iqr1 = quantile(days_vac_exposure, probs = 0.25),
#           iqr3 = quantile(days_vac_exposure, probs = 0.75))
kruskal.test(days_vac_exposure ~ age_cat, sele)
84*123/288
chisq.test(sele_p$gender, sele_p$vac_history, simulate.p.value = T)
sele_n <- cat_ll %>%
filter(outcome == 0) %>%
mutate(across(.cols = c(vac_history, gender, clnc_outcome),
.fns = as.factor))
sele_n <- sele_n %>%
filter(vac_history == 2)
kruskal.test(days_vac_exposure ~ age_cat, data = sele_n)
median_test(days_vac_exposure ~ age_cat, data = sele_n)
chisq.test(sele_n$gender, sele_n$vac_history)
sele_n <- cat_ll %>%
filter(outcome == 0) %>%
mutate(across(.cols = c(vac_history, gender, clnc_outcome),
.fns = as.factor))
# sele_n %>%
#         t_test(age ~ vac_history)
chisq.test(sele_n$gender, sele_n$vac_history)
